# Cursor コンテキスト管理ガイド (v2)

## 1. 目的

このガイドは、Cursor を使用した開発において、GitHub Issue などの小さなタスク単位で会話スレッドを新規に立ち上げる際に、毎回背景説明や関連ドキュメントを手動で読み込ませることなく、既存の開発ドキュメント（`Docs/dev-docs/` 配下など）の内容を Cursor が効率的に理解し、自律的に活用するための手順を定めることを目的とします。

これにより、以下の効果を目指します。

-   開発効率の向上（コンテキスト読み込み時間の短縮）
-   指示の精度向上（開発ルールや背景知識の反映）
-   開発ドキュメントの活用促進と一貫性の維持

## 2. 現状の課題

-   Cursor の各会話スレッドは基本的に独立しており、過去の会話履歴やワークスペース内のドキュメント知識を自動的に引き継がない。
-   新しいタスクを開始するたびに、関連する開発ドキュメント（コーディング規約、自動記録ガイド、プロジェクト概要など）を `@` コマンドなどで手動指定する必要があり、手間がかかる。
-   どのドキュメントを読み込ませるべきか、毎回判断が必要になる。

## 3. 提案する解決策：Cursor Rules と @Docs/@file の活用

Cursor が提供する **Rules 機能** と **@Docs 機能**、および従来の **@file 機能** を組み合わせることで、コンテキスト管理を効率化します。

**基本的な考え方:**

1.  **常に適用すべきルールや参照すべき基本ドキュメントは「Cursor Rules」で定義する。**
    -   **User Rules**: 個人の開発スタイルや常に守るべきグローバルなルール (例: 応答言語、基本的なコーディングスタイル) を定義します。 [参考: Cursor User Rules](https://docs.cursor.com/context/rules#user-rules)
    -   **Project Rules**: プロジェクト固有のルール、規約、参照すべき主要ドキュメントへのポインタなどを定義します。`.cursor/rules` ディレクトリに `.mdc` ファイルとして保存し、バージョン管理します。[参考: Cursor Project Rules](https://docs.cursor.com/context/rules#project-rules)
2.  **頻繁に参照する外部ドキュメントや社内ドキュメントは「@Docs」に登録する。**
    -   URL を指定してカスタムドキュメントを Cursor にインデックスさせ、`@Docs` シンボルで簡単に呼び出せるようにします。[参考: Cursor @Docs](https://docs.cursor.com/context/@-symbols/@-docs)
3.  **個別のタスクで特に重要なコンテキストは「@file」または「@Docs」で具体的に与える。**
    -   タスクに直接関連するローカルファイルは `@file` で、登録済みの外部ドキュメントは `@Docs` で指定します。

## 4. 具体的な手順

GitHub Issue など、新しい開発タスクを開始する際の具体的な手順は以下の通りです。

1.  **Cursor で新しい会話スレッドを開始します。**
2.  **User Rules の設定（初回のみ、または更新時）:**
    -   `Cursor Settings > Rules` で、個人用の User Rules を設定します。
        ```text
        # 例:
        応答は常に日本語でお願いします。
        技術的な説明は簡潔に、必要であれば参考リンクを示してください。
        ```
3.  **Project Rules の設定（初回のみ、または更新時）:**
    -   プロジェクトルートに `.cursor/rules` ディレクトリを作成します。
    -   主要な開発ドキュメントを参照させるルールを作成します (例: `DocsReferenceRule.mdc`)。
        ```mdc
        ---
        description: 主要な開発ドキュメントの参照を促すルール
        alwaysApply: true # または autoAttached で Docs/dev-docs/ 配下のファイル編集時に適用など
        ---

        開発を進めるにあたり、以下の主要ドキュメントの内容を常に考慮してください。
        必要に応じて `@Docs/dev-docs/[ドキュメント名].md` で内容を確認してください。

        - @Docs/dev-docs/Overall_Development_Guidelines.md (全体的な開発ガイドライン)
        - @Docs/dev-docs/Coding_Standards.md (コーディング規約)
        - @Docs/dev-docs/Auto_Logging_Guide.md (自動記録ガイド)

        `Auto_Logging_Guide.md` に従い、会話ログは `Docs/dev-records/` 内の日次開発日記に記録してください。
        不明な点や複数の選択肢がある場合は、勝手に判断せず質問してください。
        GitHub Issue に基づいて作業する場合、その Issue の目的と受け入れ基準を理解するように努めてください。
        ```
    -   ルールファイル内で `@` を使ってファイルを参照すると、ルール適用時にそのファイル内容もコンテキストに含まれます。
    -   ルールの種類 (`alwaysApply`, `autoAttached`, `agentRequested`, `manual`) は、ドキュメントの性質や適用したいタイミングに応じて設定します。[参考: Rule Structure](https://docs.cursor.com/context/rules#rule-structure)
    -   `Cmd + Shift + P` > "New Cursor Rule" でテンプレートから作成できます。
    -   ルールは Git でバージョン管理します。
4.  **@Docs の登録（必要に応じて）:**
    -   頻繁に参照する外部ドキュメント (例: API リファレンス、デザインシステムのサイト) があれば、`@Docs > Add new doc` で URL を登録します。末尾に `/` をつけるとサブページもインデックスされます。
5.  **タスク開始時の指示:**
    -   新しい会話スレッドの最初のメッセージで、以下のように指示します。
        ```
        Issue #[Issue番号] 「[Issueタイトル]」 の開発を開始します。

        Project Rules および User Rules が適用されているはずです。
        このタスクに特に関連するドキュメントとして以下を読み込んでください:
        @Docs/dev-docs/[タスク特有のドキュメント.md]
        @Docs/[登録した外部ドキュメント名] (もしあれば)

        これらのコンテキストを踏まえ、タスクを進めてください。不明な点があれば質問してください。
        ```
    -   `@` で指定するドキュメントは、タスク内容に応じて最も重要なものに絞ります。Rules で常に参照されるドキュメントは、ここで再度指定する必要はありません（ただし、明示的に意識させたい場合は指定しても良いでしょう）。

## 5. 期待される効果

-   **コンテキスト設定の自動化・効率化:** Rules により、毎回同じ指示をする手間が省けます。
-   **指示精度と一貫性の向上:** Cursor が常に開発ルールや規約を考慮するようになります。
-   **ナレッジの集約と活用:** `@Docs` や Rules 内の参照により、分散した情報を Cursor が活用しやすくなります。
-   **開発ドキュメントの形骸化防止:** Rules で参照されることで、ドキュメントが開発プロセスに組み込まれやすくなります。

## 6. 今後の検討事項

-   Cursor の機能アップデート（例: Rules の Team 共有機能 [参考](https://docs.cursor.com/context/rules#team-rules)）があれば、この手順を見直します。
-   Project Rules の最適な分割・構成方法の検討。
-   `Auto Attached` や `Agent Requested` タイプの Rules を活用した、より動的なコンテキスト提供方法の模索。
-   `@Docs` でインデックスされた情報の鮮度や精度に関する検証。 
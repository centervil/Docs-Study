## 📚 今日の学習テーマ：セキュリティ応用と防御技術

### 📝 学習の目標

* TLS（Transport Layer Security）の概念と、通信を保護する仕組みを理解する。
* PKI（Public Key Infrastructure）の役割と、デジタル証明書がどのように機能するかを把握する。
* OWASP Top 10などの脆弱性分類を理解し、一般的な脅威とその対策の考え方を学ぶ。

### 🔍 カバーする範囲

Day 20では、Day 19で学んだ情報セキュリティの基礎知識を応用し、具体的な防御技術に焦点を当てます。TLSの仕組み、PKIの役割、そしてWebアプリケーションにおける代表的な脆弱性とその対策について学習します。

## 📖 解説パート

### TLSの概念と通信保護

TLS（Transport Layer Security）は、インターネット上でデータを安全に送受信するためのプロトコルです。WebブラウザとWebサーバー間の通信（HTTPS）や、メール送受信（SMTPS, IMAPS, POP3S）などで広く利用されています。TLSの主な目的は、通信の「機密性（Confidentiality）」、「完全性（Integrity）」、「認証（Authentication）」の3つを確保することです。

*   **機密性:** 通信内容が第三者に傍受されても、内容を理解できないように暗号化します。具体的には、通信開始時に「ハンドシェイク」と呼ばれるプロセスを経て、共通鍵を生成し、その鍵を用いてデータを暗号化・復号します。
*   **完全性:** 通信中にデータが改ざんされていないことを保証します。データのハッシュ値を計算し、暗号化して付与することで、受信側で改ざんを検知できるようにします。
*   **認証:** 通信相手が正当なエンティティであることを確認します。主にサーバー証明書を用いて、接続先のサーバーが正規のものであるかを確認します。これにより、中間者攻撃（Man-in-the-Middle Attack）を防ぎます。

TLSのバージョンは、TLS 1.0、1.1、1.2、1.3と進化しており、新しいバージョンほどセキュリティ強度が高く、効率的な通信が可能です。特にTLS 1.3では、ハンドシェイクの高速化や、より強力な暗号アルゴリズムの採用が進んでいます。

### PKIの役割とデジタル証明書

PKI（Public Key Infrastructure）は、公開鍵暗号技術を安全かつ効率的に利用するための仕組み全体を指します。PKIの主要な構成要素には、認証局（CA: Certificate Authority）、登録局（RA: Registration Authority）、証明書利用者、証明書失効リスト（CRL: Certificate Revocation List）などがあります。

PKIの中心的な役割を担うのが認証局（CA）です。CAは、公開鍵の所有者が本人であることを証明する「デジタル証明書」を発行します。デジタル証明書には、公開鍵、所有者の情報、発行者（CA）の情報、有効期限などが含まれており、CAの秘密鍵で署名されています。

*   **デジタル証明書の利用:** Webサイトにアクセスする際、ブラウザはサーバーから送られてきたデジタル証明書を検証します。ブラウザは、証明書に記載されたCAの公開鍵（通常、OSやブラウザにあらかじめ信頼できるCAのリストとして組み込まれています）を用いて、証明書の署名を検証します。署名が正しく、証明書が有効期限内であれば、そのサーバーは信頼できると判断されます。
*   **PKIの重要性:** PKIは、インターネット上での信頼関係を構築するための基盤となります。これにより、ユーザーは正規のWebサイトにアクセスしていることを確認でき、安全な通信が可能になります。

### 脆弱性分類（OWASP Top 10）と対策

OWASP（Open Web Application Security Project）が公開している「OWASP Top 10」は、Webアプリケーションにおける最も深刻なセキュリティリスクをまとめたリストです。これは、開発者やセキュリティ担当者が、どのような脅威に注意すべきかを理解するための重要な指標となります。代表的な脆弱性とその対策の考え方を以下に示します。

*   **インジェクション (Injection):** SQLインジェクション、OSコマンドインジェクションなどが含まれます。信頼できない入力データを、コマンドやクエリの一部として解釈・実行してしまうことで発生します。
    *   **対策:** 入力値の検証（バリデーション）と、エスケープ処理、プリペアドステートメントの使用。
*   **認証の失敗 (Broken Authentication):** ユーザー名やパスワードの管理不備、セッション管理の不備などにより、不正な認証を許してしまう脆弱性です。
    *   **対策:** 強力なパスワードポリシー、多要素認証、セキュアなセッション管理。
*   **機密データの露出 (Sensitive Data Exposure):** 保存中や転送中の機密データ（個人情報、認証情報など）が、不十分な保護により漏洩するリスクです。
    *   **対策:** データの暗号化（保存時・転送時）、アクセス制御の強化。
*   **XML外部エンティティ (XXE):** XMLパーサーが、外部エンティティを参照する設定になっている場合に、意図しないファイルアクセスやサービス妨害（DoS）を引き起こす可能性があります。
    *   **対策:** XMLパーサーの設定見直し、入力データの無害化。
*   **アクセス制御の不備 (Broken Access Control):** 認証されたユーザーが、本来アクセスできないはずのリソースにアクセスできてしまう問題です。
    *   **対策:** 厳格なアクセス権限管理、ロールベースアクセス制御（RBAC）の実装。
*   **セキュリティ設定のミス (Security Misconfiguration):** デフォルト設定のまま運用したり、不要な機能やサービスを有効にしたままにすることで発生する脆弱性です。
    *   **対策:** 最小権限の原則に基づいた設定、不要な機能の無効化、定期的な設定レビュー。

#### 重要ポイント

*   TLSは、通信の機密性、完全性、認証を保証し、安全なデータ送受信の基盤となる。
*   PKIは、デジタル証明書を通じて公開鍵の正当性を保証し、インターネット上の信頼関係を構築する。
*   OWASP Top 10は、Webアプリケーションにおける主要な脆弱性を理解し、対策を講じるための指針となる。

## 🏢 ケーススタディ

### ケース：ECサイトにおけるセッションハイジャック攻撃

あるECサイトで、顧客のセッションIDが推測されやすい、あるいはHTTP通信で平文で送信されていたため、攻撃者にセッションIDを盗まれました。攻撃者はそのセッションIDを悪用し、正規の顧客になりすまして、その顧客のアカウントで不正に商品を購入したり、個人情報を閲覧したりする行為に成功しました。

#### 問題点

*   セッションIDの推測容易性、または平文での送信による漏洩。
*   セッション管理の不備（有効期限切れのセッションの再利用、IPアドレスの固定化など）。
*   顧客アカウントに対する、より厳格なアクセス制御や監視体制の欠如。

#### 対応策

*   セッションIDには、推測困難で十分な長さとランダム性を持つ値を生成する。
*   セッションIDはHTTPS通信（TLS）経由でのみ送信し、Cookieには`Secure`属性と`HttpOnly`属性を付与する。
*   セッションの有効期限を適切に設定し、一定時間操作がない場合は強制的にログアウトさせる。
*   可能であれば、セッションIDとIPアドレスやユーザーエージェントを紐づけ、変更があった場合は再認証を求める。
*   不正な操作（短時間での高額購入、個人情報へのアクセスなど）を検知するための監視システムを導入する。

#### ケースから学ぶ教訓

*   セキュアな通信（TLS）の利用と、セッション管理の徹底は、Webアプリケーションのセキュリティにおいて不可欠である。
*   脆弱なセッション管理は、不正アクセスやなりすましといった重大なセキュリティインシデントに直結する。
*   多層的な防御策（通信の暗号化、セッションIDの保護、アクセス制御、監視）を組み合わせることが重要である。

## 📝 理解度チェックテスト

### 問題1

TLSの主な目的として、適切でないものはどれか。

1.  機密性
2.  完全性
3.  匿名性
4.  認証

### 問題2

デジタル証明書を発行し、公開鍵の正当性を保証する役割を担うのは誰か。

1.  認証局（CA）
2.  登録局（RA）
3.  証明書利用者
4.  証明書失効リスト（CRL）

### 問題3

OWASP Top 10に挙げられる脆弱性の一つである「SQLインジェクション」は、どのような攻撃手法に分類されるか。

1.  アクセス制御の不備
2.  インジェクション
3.  セキュリティ設定のミス
4.  機密データの露出

### 問題4

Webアプリケーションのセッション管理において、セッションIDを保護するためにHTTPS通信と併せて考慮すべきCookieの属性はどれか。

1.  `Domain`
2.  `Path`
3.  `Secure` および `HttpOnly`
4.  `Expires`

### 問題